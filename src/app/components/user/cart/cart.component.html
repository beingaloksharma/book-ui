<div class="cart-wrapper">
    <div class="cart-header">
        <h1>Your Shopping Cart</h1>
        <span class="badge">{{ cartItems.length }} items</span>
    </div>

    <div *ngIf="loading" class="loading-state">Loading cart details...</div>

    <div *ngIf="!loading && cartItems.length === 0" class="empty-state">
        <div class="empty-icon">ðŸ›’</div>
        <h3>Your cart is empty</h3>
        <p>Looks like you haven't added any books yet.</p>
        <a routerLink="/books" class="btn btn-primary">Start Shopping</a>
    </div>

    <div *ngIf="!loading && cartItems.length > 0" class="cart-layout">

        <!-- LEFT COLUMN: Cart Items -->
        <div class="cart-items-section">
            <div class="cart-table-header">
                <span>Product</span>
                <span>Quantity</span>
                <span>Total</span>
            </div>

            <div class="cart-item-row" *ngFor="let item of cartItems">
                <div class="product-info">
                    <div class="book-cover-placeholder"></div>
                    <div class="details">
                        <h3>{{ item.book?.title || 'Unknown Title' }}</h3>
                        <span class="unit-price">â‚¹{{ item.price }} / unit</span>
                    </div>
                </div>

                <div class="quantity-control">
                    <button class="qty-btn" (click)="decrementQuantity(item)">âˆ’</button>
                    <span class="qty-val">{{ item.quantity }}</span>
                    <button class="qty-btn" (click)="incrementQuantity(item)">+</button>
                </div>

                <div class="item-actions">
                    <div class="item-total">
                        â‚¹{{ (item.total || (item.price * item.quantity)) | number:'1.2-2' }}
                    </div>
                    <button class="btn-delete" (click)="deleteItem(item)" title="Remove Item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: Billing & Summary -->
        <div class="cart-sidebar">
            <div class="summary-card">
                <h3>Order Summary</h3>

                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>â‚¹{{ totalAmount | number:'1.2-2' }}</span>
                </div>
                <div class="summary-row">
                    <span>Tax (Sample 5%)</span>
                    <span>â‚¹{{ totalAmount * 0.05 | number:'1.2-2' }}</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-row total">
                    <span>Total</span>
                    <span>â‚¹{{ totalAmount * 1.05 | number:'1.2-2' }}</span>
                </div>

                <div class="billing-section">
                    <h4>Billing & Shipping</h4>

                    <div class="form-group" *ngIf="savedAddresses.length > 0">
                        <label>Select Saved Address</label>
                        <select [(ngModel)]="selectedAddressIndex" (change)="onAddressSelect()" class="form-control">
                            <option *ngFor="let addr of savedAddresses; let i = index" [value]="i">
                                {{ addr.street }}, {{ addr.city }}
                            </option>
                            <option value="new">+ Add New Address</option>
                        </select>
                    </div>

                    <form class="billing-form">
                        <div class="form-group">
                            <input [(ngModel)]="shippingAddress.street" name="street" placeholder="Street Address"
                                required>
                        </div>
                        <div class="form-group">
                            <input [(ngModel)]="shippingAddress.city" name="city" placeholder="City" required>
                        </div>
                        <div class="form-group">
                            <input [(ngModel)]="shippingAddress.state" name="state" placeholder="State" required>
                        </div>
                        <div class="form-grid">
                            <input [(ngModel)]="shippingAddress.country" name="country" placeholder="Country" required>
                            <input [(ngModel)]="shippingAddress.zip_code" name="pincode" placeholder="Zip Code"
                                required>
                        </div>

                        <div *ngIf="selectedAddressIndex === 'new'" class="mb-3">
                            <button type="button" class="btn btn-sm btn-outline-primary" (click)="saveNewAddress()">
                                Save this Address
                            </button>
                        </div>

                        <div class="payment-group">
                            <label>Payment Method</label>
                            <select [(ngModel)]="paymentMethod" name="payment" disabled>
                                <option value="COD">Cash on Delivery (COD)</option>
                            </select>
                        </div>
                    </form>
                </div>

                <button class="btn btn-checkout btn-block" (click)="placeOrder()">
                    Checkout Now
                </button>
            </div>
        </div>
    </div>
</div>